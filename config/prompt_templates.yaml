# =========================================================
# AI Prompt Templates â€” Discord Trade Signal Intelligence
# Author: @drashadm
# Version: "1.1.1"
# Description:
# Centralized, schema-validated and production-ready prompts for all AI modules.
# =========================================================

meta:
  version: "1.1.1"
  last_updated: "2025-11-12"
  author: "DeAndrai Mullen"
  project: "Discord Trade Signal Parser â€“ AI Intelligence Extension"
  description: "Unified prompt and schema management for AI modules"

# ---------------------------------------------------------
# ðŸ”§ GLOBAL SETTINGS
# ---------------------------------------------------------
model_fallbacks:
  primary: gpt-4o-mini
  secondary: claude-3-haiku
  local_backup: gemma-2b-instruct

style_guide:
  tone: "analytical, concise, trustworthy"
  formatting: "JSON for data, bullet points for summaries"
  disclaimer: "All AI outputs are verified against rule-based baselines."

governance:
  cache_responses: true
  schema_validation: true
  error_handling: "retry_3_times"
  rate_limit_per_min: !ENV ${RATE_LIMIT_PER_MIN:-60}
  cost_tracking: true
  telemetry_log: "./metrics/usage.json"
  logging: "./logs/agent_runs.log"

privacy:
  redaction:
    enabled: true
    patterns: ["@[A-Za-z0-9_.]+", "#[0-9]{4}"]
    replace_with: "[REDACTED]"

# ---------------------------------------------------------
# SEMANTIC PARSER MODULE
# ---------------------------------------------------------
semantic_parser:
  model: gpt-4o-mini
  temperature: 0.2
  max_tokens: 500
  meta_params:
    temperature_reason: "Low randomness for deterministic parsing."
    token_budget: "Capped for predictable runtime cost."
  schema:
    type: object
    required: [alert_type, ticker, price, timestamp]
    properties:
      alert_type:
        type: string
        description: "Type of signal â€” e.g. CALL, PUT, EXIT"
      ticker:
        type: string
        description: "Stock or symbol mentioned (e.g. SPY, QQQ, NVDA)"
      price:
        type: number
        description: "Price mentioned or inferred from context"
      timestamp:
        type: string
        description: "ISO8601 formatted timestamp (UTC preferred)"
      sentiment:
        type: string
        description: "Optional: bullish / bearish / neutral tone"
      confidence:
        type: number
        minimum: 0
        maximum: 1
        description: "Optional AI confidence score"
  validators:
    - field: price
      condition: "value > 0 and value < 2000"
    - field: ticker
      condition: "no spaces or special characters"
    - field: timestamp
      condition: "must be valid ISO8601 string"
  prompt: |
    You are an expert financial text parser.
    Parse the following Discord trading alert message into a structured JSON object that matches this schema:
    - alert_type (CALL, PUT, EXIT, etc.)
    - ticker (e.g. SPY, NVDA, AAPL)
    - price (numeric)
    - timestamp (ISO8601)
    - sentiment (optional)
    - confidence (optional)
    If data is missing, infer cautiously but keep the JSON valid and within plausible market ranges.

# ---------------------------------------------------------
# NORMALIZER MODULE
# ---------------------------------------------------------
normalizer:
  model: gemma-2b-instruct
  temperature: 0.1
  meta_params:
    temperature_reason: "Minimal randomness for deterministic mapping."
  prompt: |
    You are a data harmonizer for financial tickers.
    Map variant or misspelled tickers to their canonical symbol.
    Examples:
      - SPY ETF â†’ SPY
      - NVDA Inc. â†’ NVDA
      - TESLA / TSLA â†’ TSLA
    If no confident match is found, return the original value.
  validators:
    - field: ticker
      condition: "uppercase letters only (Aâ€“Z)"
    - field: ticker
      condition: "length â‰¤ 6"

# ---------------------------------------------------------
# QUALITY SCORER MODULE
# ---------------------------------------------------------
quality_scorer:
  model: gpt-4o-mini
  temperature: 0
  rules:
    - condition: "price missing or malformed"
      penalty: 0.2
    - condition: "ticker not recognized"
      penalty: 0.1
    - condition: "timestamp older than 30 days"
      penalty: 0.1
      dynamic_ref: "current_utc_date"
    - condition: "full schema match"
      reward: 0.3
    - condition: "consistent sentiment and alert_type"
      reward: 0.1
  prompt: |
    You are a data quality auditor.
    Evaluate this JSON record for completeness, consistency, and realism.
    Output a numeric quality_score between 0.0 and 1.0 and a concise rationale.

# ---------------------------------------------------------
# SUMMARIZER MODULE
# ---------------------------------------------------------
summarizer:
  model: gpt-4o-mini
  temperature: 0.4
  max_tokens: 800
  style: concise
  meta_params:
    temperature_reason: "Higher creativity allowed for natural-language summaries."
  prompt: |
    Summarize this trading signal dataset.
    Highlight:
      - Total number of alerts
      - Most frequent tickers
      - Average signal price
      - Signal type breakdown (CALL vs PUT vs EXIT)
      - Notable sentiment patterns
      - Any anomalies in price or frequency
    Write the summary in an analytical tone consistent with the project style guide.
    Example:
      "In the last 7 days, 63 % of alerts were CALLs, primarily on SPY, NVDA, and QQQ.
       Average signal price was $532. Volume of alerts increased 12 % week-over-week."

# ---------------------------------------------------------
# AGENT / ORCHESTRATOR MODULE
# ---------------------------------------------------------
agent:
  orchestrator: "LangGraph"
  mode: "cron_or_git_trigger"
  workflow:
    - check_new_data
    - run_parser
    - normalize
    - score_quality
    - summarize
    - commit_outputs
  governance:
    inherit_global: true
    max_retries: 3
    notify_on_fail: true
    alert_channel_env: DISCORD_ALERT_WEBHOOK
    cache_responses: true
    schema_validation: true
    diff_commit_threshold: 0.05  # commit only if > 5 % data delta
    validation_before_commit: true
